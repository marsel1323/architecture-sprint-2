# mongo-sharding

Проект для демонстрации шардирования в MongoDB и работы с FastAPI.

**Важно:** В этом проекте используется MongoDB версии 4.4 с архитектурой `linux/amd64` для совместимости с процессором
M1 на macOS. На других платформах рекомендуется использовать последнюю стабильную версию MongoDB, совместимую с
проектом.

## Как запустить

1. Запуск MongoDB и приложения

   Запустите Docker Compose, чтобы поднять контейнеры MongoDB и FastAPI приложения:

   ```shell
   docker compose up -d
   ```

2. Инициализация шардирования

   Выполните скрипт инициализации mongo-init.sh, чтобы настроить шардирование и распределение данных между шардовыми
   кластерами:

   ```shell
   ./scripts/1 mongo-init.sh
   ```

3. Наполнение базы данных

   Запустите скрипт наполнения mongo-fill.sh для добавления данных в коллекцию helloDoc в базе данных somedb:

   ```shell
   ./scripts/2 mongo-fill.sh
   ```

## Как проверить

1. Тестирование шардирования и данных

   Запустите скрипт тестирования mongo-tests.sh, который проверит количество документов в каждом шарде и общее
   количество документов в базе:

   ```shell
   ./scripts/3 mongo-tests.sh
   ```

2. Документация FastAPI

   После успешного запуска API-документация FastAPI будет доступна по адресу:

   http://localhost:8080/docs

Содержание скриптов

- mongo-init.sh: Инициализирует репликации и шардирование в MongoDB. 
- mongo-fill.sh: Заполняет базу данных somedb коллекцией helloDoc с тестовыми данными. 
- mongo-tests.sh: Проверяет корректность данных и распределение документов по шардовым кластерам.
